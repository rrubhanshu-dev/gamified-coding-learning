{% extends "base.html" %}

{% block title %}Edit Test - Admin{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="container">
        <h1 class="page-title">Edit Test: {{ test.title }}</h1>
        
        <div class="form-container">
            <form method="POST" class="question-form">
                <div class="form-group">
                    <label for="title">Test Title *</label>
                    <input type="text" id="title" name="title" required class="form-control" 
                           value="{{ test.title }}">
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" class="form-control" rows="3">{{ test.description or '' }}</textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="subject_id">Subject</label>
                        <select id="subject_id" name="subject_id" class="form-control">
                            <option value="">No Subject</option>
                            {% for subject in subjects %}
                            <option value="{{ subject.id }}" {% if test.subject_id == subject.id %}selected{% endif %}>
                                {{ subject.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="time_limit_minutes">Time Limit (minutes) *</label>
                        <input type="number" id="time_limit_minutes" name="time_limit_minutes" 
                               required class="form-control" value="{{ test.time_limit_minutes }}" min="1">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="passing_score">Passing Score (%) *</label>
                        <input type="number" id="passing_score" name="passing_score" 
                               required class="form-control" value="{{ test.passing_score }}" min="0" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status" name="status" class="form-control">
                            <option value="draft" {% if test.status == 'draft' %}selected{% endif %}>Draft</option>
                            <option value="published" {% if test.status == 'published' %}selected{% endif %}>Published</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="assigned_to_all" value="on" {% if test.assigned_to_all %}checked{% endif %}>
                        Assign to all students
                    </label>
                </div>
                
                <div class="form-group">
                    <label>Select Questions *</label>
                    <div class="questions-selection" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 1rem;">
                        {% for question in questions %}
                        <label style="display: block; padding: 0.5rem; border-bottom: 1px solid #eee;">
                            <input type="checkbox" name="question_ids" value="{{ question.id }}" 
                                   {% if question.id in selected_question_ids %}checked{% endif %}>
                            <strong>{{ question.title }}</strong> - {{ question.topic }} ({{ question.difficulty }})
                        </label>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Update Test</button>
                    <a href="{{ url_for('admin_tests') }}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
            
            <!-- Assign to Students -->
            <div class="assign-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #ddd;">
                <h3>Assign to Students</h3>
                {% if assigned_students %}
                <p><strong>Currently Assigned:</strong></p>
                <ul>
                    {% for student in assigned_students %}
                    <li>{{ student.username }} (assigned on {{ student.assigned_at }})</li>
                    {% endfor %}
                </ul>
                {% endif %}
                
                <form method="POST" action="{{ url_for('admin_assign_test', test_id=test.id) }}">
                    <div class="form-group">
                        <label>Add More Students (Enter User IDs separated by commas):</label>
                        <input type="text" name="user_ids" class="form-control" 
                               placeholder="e.g., 2, 5, 10">
                        <small>You can find user IDs in the <a href="{{ url_for('admin_users') }}">Users Management</a> page</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Assign Test</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
